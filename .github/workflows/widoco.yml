name: Generate PLATO Documentation

on:
  push:
    branches:
      - main
    paths:
      - 'plato-ontology.ttl'
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for manual run'
        required: false
        default: 'Manual documentation refresh'

jobs:
  build-docs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '11'

      - name: Download Latest Widoco
        run: |
          sudo apt-get update && sudo apt-get install -y jq
    
          LATEST_URL=$(curl -s https://api.github.com/repos/dgarijo/Widoco/releases/latest \
            | jq -r '.assets[] | select(.name | endswith(".jar")) | .browser_download_url' \
            | head -n 1)
      
          if [ -z "$LATEST_URL" ] || [ "$LATEST_URL" = "null" ]; then
            echo "Error: Could not find Widoco JAR."
            exit 1
          fi
      
          echo "Downloading from: $LATEST_URL"
          curl -L "$LATEST_URL" -o widoco.jar

      - name: Run Widoco
        run: |
          java -jar widoco.jar \
            -ontFile plato-ontology.ttl \
            -outFolder ./docs \
            -rewriteAll \
            -webVowl \
            -includeImported \
            -licensText "CC BY 4.0" \
            -licensURI "https://creativecommons.org/licenses/by/4.0/"

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs